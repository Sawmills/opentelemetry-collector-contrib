# KEDA Scaler Exporter

<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | beta: metrics   |
| Distributions | contrib |
| Code Owners   | [@sawmills](https://github.com/sawmills) |
<!-- end autogenerated section -->

The **KEDA Scaler Exporter** is an [OpenTelemetry Collector](https://opentelemetry.io/docs/collector/) exporter that exposes a gRPC service compatible with [KEDA](https://keda.sh/)'s external scaler interface. It enables KEDA to scale workloads based on custom metrics ingested via OpenTelemetry, and provides HTTP endpoints for monitoring and querying metrics.

## Features

- **KEDA External Scaler gRPC API**: Implements the gRPC interface required by KEDA for external scaling.
- **PromQL-like Query Support**: Supports PromQL-like queries for evaluating custom metrics.
- **HTTP Monitoring API**: Exposes endpoints for querying and inspecting stored metrics.
- **Configurable Retention and Cleanup**: Flexible settings for data retention and cleanup intervals.

## Configuration

Add the exporter to your OpenTelemetry Collector configuration. Example:

```yaml
exporters:
  kedascaler:
    scaler_grpc:
      endpoint: "0.0.0.0:4318"
    monitoring_http:
      endpoint: "0.0.0.0:9090"
    engine_settings:
      timeout: 30s
      max_samples: 500000
      lookback_delta: 5m
      retention_duration: 2m
    cleanup_interval: 30s
```

### Configuration Options

- **scaler_grpc**: gRPC server config for the scaler service (default: `localhost:4318`).
- **monitoring_http**: HTTP server config for monitoring endpoints (default: `localhost:9090`).
- **engine_settings**:
  - `timeout`: Max duration for processing queries.
  - `max_samples`: Max number of samples processed.
  - `lookback_delta`: How far back to look for data points.
  - `retention_duration`: How long to keep data in memory.
- **cleanup_interval**: Interval for cleaning up old data (default: 30s).

## Usage

1. **Enable the Exporter**: Add `kedascaler` to the `exporters` section of your OpenTelemetry Collector config.
2. **Configure KEDA**: Set up a KEDA `ScaledObject` to use the exporter's gRPC endpoint as an external scaler.
3. **Query Metrics**: Use the HTTP API for metric introspection:
   - `GET /data`: List all stored metric series.
   - `GET /names`: List all metric series names.
   - `POST /query`: Query metrics with a PromQL-like expression.

## Advanced Configuration

See [config.go](./config.go) for all available settings and advanced options.

## Development & Testing

- Unit tests are provided.
- Follow Go best practices and OpenTelemetry Collector exporter conventions.
- Contributions are welcome! Please ensure new code is covered by tests.

## License

This project is licensed under the same terms as the OpenTelemetry Collector Contrib repository. See the [LICENSE](../../LICENSE) file for details.
